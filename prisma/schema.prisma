generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGO_URL_MONGODB_URI")
}

enum Role {
  MASTER
  OWNER
  CONSULTOR
}

enum Escritorio {
  JLC_TECH
  SAFE_TI
}

enum LeadStatus {
  NOVO
  EM_CONTATO
  EM_NEGOCIACAO
  FECHADO
  PERDIDO
}

model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String   @unique
  password      String
  role          Role
  escritorio    Escritorio?
  ownerId       String?  @db.ObjectId
  owner         User?    @relation("OwnerConsultor", fields: [ownerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  team          User[]   @relation("OwnerConsultor")
  officeId      String?  @db.ObjectId
  office        Office?  @relation(fields: [officeId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  leadsAssigned Lead[]   @relation("AssignedLeads")
  leadsOwned    Lead[]   @relation("LeadOwner")
  isActive      Boolean  @default(true)
}

model Campanha {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  nome        String
  descricao   String?
  createdAt   DateTime @default(now())
  createdById String?  @db.ObjectId
  totalLeads      Int     @default(0)
  assignedLeads   Int     @default(0)
  remainingLeads  Int     @default(0)
  isActive        Boolean @default(true)

  leadsBrutos Lead[]   @relation("CampanhaLeads")
}

model Lead {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  campanhaId    String      @db.ObjectId
  campanha      Campanha    @relation("CampanhaLeads", fields: [campanhaId], references: [id])

  cnpj          String?
  razaoSocial   String?
  nomeFantasia  String?
  vertical      String?
  cidade        String?
  estado        String?
  telefone      String?
  email         String?
  telefone1     String?
  telefone2     String?
  telefone3     String?
  logradouro    String?
  numero        String?
  cep           String?
  endereco      String?
  territorio    String?
  ofertaMkt     String?
  estrategia    String?
  armario       String?
  idPruma       String?
  vlFatPresumido String?
  cnae          String?

  status        LeadStatus  @default(NOVO)
  consultorId   String?     @db.ObjectId
  consultor     User?       @relation("AssignedLeads", fields: [consultorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ownerId       String?     @db.ObjectId
  owner         User?       @relation("LeadOwner", fields: [ownerId], references: [id])
  officeId      String?     @db.ObjectId
  office        Office?     @relation(fields: [officeId], references: [id])
  historico     Json?
  raw           Json?
  lastStatusChangeAt DateTime?
  lastInteractionAt DateTime?
  interactionCount  Int      @default(0)

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Office {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  code      Escritorio @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
  leads     Lead[]
}
